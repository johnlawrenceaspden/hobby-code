
(float (+ 1)) ; 1.0
(float (+ 1 1/4)) ; 1.25
(float (+ 1 1/4 1/16)) ; 1.3125
(float (+ 1 1/4 1/16 1/64)) ; 1.328125
(float (+ 1 1/4 1/16 1/64 1/256)) ; 1.3320312
(float (+ 1 1/4 1/16 1/64 1/256 1/1024)) ; 1.3330078

(take 7 (reductions + (iterate #(/ % 4) 1))) ; (1 5/4 21/16 85/64 341/256 1365/1024 5461/4096)

(float (+ 5 4/2 5/4 4/8 5/16 4/32 5/64 4/128 5/256 4/512 5/1024)) ; 9.329102

(map float
     (reductions +
                 (map * 
                      (apply concat (repeat [5 4]))
                      (iterate #(/ % 2) 1)))) ; (5.0 7.0 8.25 8.75 9.0625 9.1875 9.265625 9.296875 9.316406 9.324219 9.329102 9.331055 9.332275 9.332764 9.333069 9.333191 9.333267 9.333298 9.333317 9.333324 9.333329 9.333331 9.333332 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 9.333333 ...)

(map float
     (reductions +
                 (map * 
                      (apply concat (repeat [4 5]))
                      (iterate #(/ % 2) 1)))) ; (4.0 6.5 7.5 8.125 8.375 8.53125 8.59375 8.6328125 8.6484375 8.658203 8.662109 8.664551 8.665527 8.666138 8.666382 8.666534 8.666595 8.666634 8.666649 8.666658 8.666662 8.666664 8.666666 8.666666 8.666666 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 8.666667 ...)

(defn finite-sums [seq discount]
  (reductions +
              (map * 
                   (apply concat (repeat seq))
                   (iterate #(/ % discount) 1))))

(finite-sums [1] 2)
(finite-sums (repeat 1) 2)
(finite-sums [5] 2)
(finite-sums [4 5] 2)
(finite-sums [5 4] 2)


(defn infinite-sum-approx [seq discount]
  (float (nth (finite-sums seq discount) 1000)))

(infinite-sum-approx [1] 2) ; 2.0
(infinite-sum-approx [1] 3) ; 1.5
(infinite-sum-approx [1] 4) ; 1.3333334


(defn infinite-sum [seq gamma]
  (/ (reduce + 
        (map * 
             (take (count seq) (iterate #(* % gamma) 1))
             seq))
   (- 1 (reduce * (repeat (count seq) gamma)))))


(infinite-sum [1] 1/2) ; 2N ; 2N
(infinite-sum [1] 1/3) ; 3/2 ; 3/2
(infinite-sum [2] 1/3) ; 3N ; 3N
(infinite-sum [2 2 2] 1/3) ; 3N ; 3N

(float (infinite-sum [2 1 0] 1/3)) ; 2.4230769
(infinite-sum-approx [2 1 0] 3) ; 2.4230769

(float (infinite-sum [2 1 0] 0.9)) ; 10.701107
(float (infinite-sum [2 1 0] 0.8)) ; 5.7377048
(float (infinite-sum [2 1 0] 0.1)) ; 2.102102

(float (infinite-sum [0 1 2] 0.9)) ; 9.298893
(float (infinite-sum [2 1 0] 0.9)) ; 10.701107
(float (infinite-sum [1 0 2] 0.9)) ; 9.667896

(infinite-sum [0 1 2] 0.9) ; 9.298892988929893
(infinite-sum [2 1 0] 0.9) ; 10.701107011070114
(infinite-sum [1 0 2] 0.9) ; 9.667896678966793

(infinite-sum [0 1 2] 9/10) ; 2520/271
(infinite-sum [2 1 0] 9/10) ; 2900/271
(infinite-sum [1 0 2] 9/10) ; 2620/271

(/ 271.0) ; 0.0036900369003690036
(/ 369 99999) ; 1/271

(infinite-sum [0 1 2] 1/10) ; 40/333  120/999
(infinite-sum [2 1 0] 1/10) ; 700/333 210/999
(infinite-sum [1 0 2] 1/10) ; 340/333 102/999

(infinite-sum [0 1 2] 0.1) ; 0.12012012012012013 ; 40/333  120/999
(infinite-sum [2 1 0] 0.1) ; 2.1021021021021022  ; 700/333 210/999
(infinite-sum [1 0 2] 0.1) ; 1.021021021021021   ; 340/333 102/999


(* 3 271)
(- 1000 813)
   



(infinite-sum [0 1 2] 0.9) ; 9.298892988929893
(infinite-sum [2 1 0] 0.9) ; 10.701107011070114
(infinite-sum [1 0 2] 0.9) ; 9.667896678966793

